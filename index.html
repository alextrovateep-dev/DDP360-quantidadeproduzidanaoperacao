<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TeepOEE - Validação de Sequência entre Operações</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <header class="app-header">
        <h1>TeepOEE – Validação de Sequência entre Operações</h1>
        <div class="op-selector">
            <label for="opSelect">Ordem de Produção</label>
            <select id="opSelect"></select>
            <button id="reloadData" class="btn-warning" title="Recarregar dados">⟳</button>
            <button id="resetSim" class="btn-warning" title="Resetar simulação">Reset Teste</button>
        </div>
    </header>
    <div class="disclaimer-banner" role="note">
        Este é um sistema ilustrativo da lógica. Não é a versão oficial do sistema.
    </div>
    <div class="shell">
        <aside class="sidebar">
            <nav class="side-nav">
                <button id="navApontamento" class="nav-btn active">Apontamento</button>
                <button id="navDDP" class="nav-btn">DDP 360</button>
            </nav>
        </aside>
        <div class="main-content">
            <div id="pageApontamento">
                <div class="apontamento-shell">
                    <div class="apontamento-main">
                        <section class="panel escalation-panel" aria-label="Configuração de escalonamento por email">
                            <div class="panel-header">
                                <h2>Escalonamento por Email</h2>
                                <span class="panel-sub">Defina o tempo máximo para o supervisor responder antes do disparo automático de email.</span>
                            </div>
                            <div class="escalation-config">
                                <label for="emailEscalationInput">Tempo para disparo do email (minutos)</label>
                                <div class="escalation-controls">
                                    <input type="number" id="emailEscalationInput" min="1" step="1" />
                                    <button id="emailEscalationApply" class="btn secondary">Aplicar</button>
                                </div>
                                <p class="escalation-help">
                                    Quando um evento pendente ultrapassar esse tempo, o sistema exibirá um aviso indicando que um email será enviado para a conta configurada no TeepNotificação.
                                </p>
                            </div>
                        </section>

                        <main class="layout">
                            <section class="panel operations-panel">
                                <h2>Operações da OP</h2>
                                <div id="operationsTableContainer"></div>
                            </section>
                        </main>

                        <section class="machines" id="machinesGrid"></section>

                        <section class="panel report-panel">
                            <div class="panel-header">
                                <h2>Relatório de Excessos</h2>
                                <span class="panel-sub">Eventos confirmados e justificativas</span>
                            </div>
                            <div id="eventReportContainer" class="report-table-wrapper"></div>
                        </section>
                    </div>

                    <aside class="supervisor-panel" aria-label="Simulação do aplicativo do supervisor">
                        <header class="supervisor-header">
                            <div class="supervisor-title">App Supervisor • Simulação</div>
                            <small class="supervisor-subtitle">Pendentes aguardando justificativa</small>
                        </header>
                        <section class="supervisor-body">
                            <ul id="eventPendingList" class="event-list" aria-live="polite"></ul>
                        </section>
                    </aside>
                </div>
            </div>

            <div id="pageDDP360" hidden>
                <section class="panel">
                    <h2>DDP 360 – Visão do Processo</h2>
                    <p>
                        Esta seção descreve, em alto nível, o processo proposto para o projeto:
                    </p>
                    <ol>
                        <li>Aquisição das previsões de OP e roteiro no ERP ao abrir a OP.</li>
                        <li>Apontamento distribuído por etapa (máquinas), com validação de sequência e pendências.</li>
                        <li>Regras: Etapa 1 limitada ao previsto da OP; demais etapas limitadas às boas da etapa anterior.</li>
                        <li>Alertas e bloqueios quando a soma de boas+refugo exceder o pendente.</li>
                        <li>Sincronização e auditoria para consolidação no TeepOEE/ERP.</li>
                    </ol>
                    <p>
                        Próximos passos: integração com ERP, autenticação por máquina, registro de turnos e motivos.
                    </p>
                    <h3>Fluxo detalhado de produção e alertas</h3>
                    <ul class="ddp-flow">
                        <li><strong>Operador</strong> registra produção etapa a etapa. O sistema confirma que boas+refugo não excedem o limite definido (previsto da OP ou boas da etapa anterior).</li>
                        <li>Ao tentar exceder o limite, surge um popup. Se o operador <em>cancelar</em>, nada é salvo. Se <em>confirmar</em>, a produção é gravada e um <strong>evento de ocorrência</strong> é aberto automaticamente para o supervisor.</li>
                        <li>O evento guarda: data/hora da confirmação, OP, etapa, máquina, limites, quantidade produzida, excesso, usuário e status “Pendente”.</li>
                        <li>O painel “App Supervisor” (simulação do celular) recebe esse evento em tempo real, aguardando justificativa.</li>
                        <li>Se o evento não for tratado dentro do tempo configurado na área “Escalonamento por Email”, o sistema exibe o aviso de que um email será disparado automaticamente para a conta parametrizada no TeepNotificação.</li>
                        <li>Quando o supervisor abrir o evento, seleciona o motivo e confirma. O status muda para “Resolvido”, é calculado o tempo de resposta e um segundo email de confirmação é disparado automaticamente, informando que o excesso foi tratado.</li>
                        <li>Todos os eventos (pendentes e resolvidos) ficam disponíveis na tabela “Relatório de Excessos”, com registros de hora da confirmação do operador, disparo de email, justificativa e tempo de resposta.</li>
                    </ul>
                    <h3>Execução do escalonamento de email</h3>
                    <p>
                        O protótipo demonstra duas notificações automáticas:
                    </p>
                    <ol class="ddp-email">
                        <li><strong>Email de alerta</strong> – Disparado quando o tempo configurado expira e o evento segue pendente. O protótipo mostra o popup “Escalonamento por Email” para sinalizar que o envio ocorrerá.</li>
                        <li><strong>Email de encerramento</strong> – Disparado quando o supervisor justifica o excesso após o alerta. O protótipo exibe o popup “Email de Encerramento”, evidenciando que a cadeia de escalonamento foi concluída.</li>
                    </ol>
                    <p>
                        Esses avisos garantem que o cliente visualize todo o ciclo: registro no terminal, recebimento no aplicativo móvel e escalonamentos automáticos por email. Para implantação oficial, basta conectar os mesmos gatilhos à infraestrutura do TeepNotificação.
                    </p>
                    <h3>Fechamento de Operação</h3>
                    <p>
                        Cada operação (máquina) possui um botão "Fechar OP" que permite ao operador finalizar o apontamento daquela etapa específica.
                    </p>
                    <ul class="ddp-flow">
                        <li>O operador pode fechar uma operação a qualquer momento, desde que tenha realizado apontamentos naquela etapa.</li>
                        <li>Ao clicar em "Fechar OP", o sistema exibe um <strong>popup de confirmação</strong> mostrando:
                            <ul style="margin-top: 8px; margin-left: 20px;">
                                <li><strong>Quantidade Prevista:</strong> quantidade planejada da OP para aquela operação</li>
                                <li><strong>Quantidade Pendente:</strong> quantidade ainda não produzida (diferença entre o limite e o já produzido)</li>
                                <li><strong>Quantidade Produzida:</strong> total de peças boas já apontadas na operação</li>
                            </ul>
                        </li>
                        <li>O operador confirma ou cancela o fechamento. Se confirmar, a operação é marcada como <strong>fechada</strong> e registrada no sistema.</li>
                        <li><strong>Após o fechamento:</strong> a operação fica bloqueada para novos apontamentos. Os campos de produção e refugo são desabilitados, e o sistema exibe uma mensagem informando que a operação está fechada.</li>
                        <li>O status de fechamento é persistido no sistema e mantido mesmo após recarregar a página. O botão "Reset Teste" limpa os fechamentos da OP atual.</li>
                        <li>Esta funcionalidade garante que, uma vez finalizada uma etapa, não haja alterações acidentais nos dados já apontados, mantendo a integridade do processo de produção.</li>
                    </ul>
                </section>

                <section class="panel">
                    <h2>Aprovação do Documento</h2>
                    <div class="approval-form">
                        <form id="ddp-approval-form">
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="ddp-empresa">Nome da Empresa</label>
                                    <input id="ddp-empresa" name="empresa-nome" type="text" required placeholder="Ex.: Facchini">
                                </div>
                                <div class="form-group">
                                    <label for="ddp-aprovador">Nome do Aprovador</label>
                                    <input id="ddp-aprovador" name="aprovador-nome" type="text" required placeholder="Ex.: João Silva">
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="ddp-cpf">CPF do Aprovador</label>
                                    <input id="ddp-cpf" name="aprovador-cpf" type="text" maxlength="14" placeholder="000.000.000-00">
                                </div>
                                <div class="form-group">
                                    <label for="ddp-cargo">Cargo/Função</label>
                                    <input id="ddp-cargo" name="aprovador-cargo" type="text" placeholder="Ex.: Gerente de Produção">
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="ddp-email">Email para Confirmação</label>
                                    <input id="ddp-email" name="aprovador-email" type="email" required placeholder="email@empresa.com.br">
                                </div>
                                <div class="form-group">
                                    <label for="ddp-observacoes">Observações (opcional)</label>
                                    <input id="ddp-observacoes" name="observacoes-aprovacao" type="text" placeholder="Comentários ou observações">
                                </div>
                            </div>
                            <div style="display:flex; justify-content:flex-end; gap:8px;">
                                <button id="ddp-approval-submit" type="submit" class="approval-button">Validar e Enviar Aprovação</button>
                            </div>
                        </form>
                        <div id="ddp-success" class="success-message" style="display:none; margin-top:12px;">✓ Aprovação enviada com sucesso.</div>
                        <div id="ddp-error" class="error-message" style="display:none; margin-top:12px;">✗ Erro ao enviar. Verifique os dados.</div>
                    </div>
                </section>
            </div>
        </div>
    </div>

    <footer class="app-footer">
        <small>DDP-FACCHINI-SEQ002 • Protótipo de validação entre operações no TeepOEE</small>
    </footer>

    <div id="popupOverlay" class="popup-overlay" hidden>
        <div class="popup-box" role="alert" aria-live="assertive">
            <span id="popupMessage"></span>
        </div>
    </div>

    <script src="app.js"></script>
    <script>
        window.addEventListener('DOMContentLoaded', () => {
            window.TeepOEEApp.init();
        });
    </script>
</body>
</html>


